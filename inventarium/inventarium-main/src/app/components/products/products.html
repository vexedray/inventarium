<div class="page-header">
  <div class="page-header-content">
    <div class="page-header-text">
      <h1 class="page-title">Gest√£o de Produtos</h1>
      <p class="page-subtitle">Visualize e gerencie todo o seu cat√°logo de produtos</p>
    </div>
    <div class="page-header-actions">
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
            <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input 
            #searchInput
            type="text" 
            class="search-input" 
            placeholder="Pesquisar produtos..." 
            [value]="searchTerm()"
            (input)="onSearchChange(searchInput.value)" 
          />
        </div>
      </div>
      <button class="btn btn-primary btn-action" (click)="goToRegistration()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <path d="M12 8V16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Novo Produto
      </button>
    </div>
  </div>
</div>

<!-- Stats Cards -->
<div class="stats-grid d-flex flex-row gap-3 flex-nowrap">
  <div class="stat-card card cursor-pointer"
       [ngClass]="{'border-primary': selectedFilter() === 'all', 'shadow': selectedFilter() === 'all'}"
       (click)="filterBy('all')">
    <div style="display:flex;align-items:center;justify-content:flex-start;width:100%;gap:1rem;position:relative;">
      <div class="stat-icon primary" style="position:absolute;left:0;top:50%;transform:translateY(-50%);">üì¶</div>
      <div style="margin:0 auto;display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <h3 class="stat-value">{{ allProductsCount }}</h3>
        <p class="stat-label">Total de Produtos</p>
      </div>
    </div>
  </div>
  <div class="stat-card card cursor-pointer"
       [ngClass]="{'border-success': selectedFilter() === 'inStock', 'shadow': selectedFilter() === 'inStock'}"
       (click)="filterBy('inStock')">
    <div style="display:flex;align-items:center;justify-content:flex-start;width:100%;gap:1rem;position:relative;">
      <div class="stat-icon success" style="position:absolute;left:0;top:50%;transform:translateY(-50%);">‚úÖ</div>
      <div style="margin:0 auto;display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <h3 class="stat-value">{{ inStockCount }}</h3>
        <p class="stat-label">Em Estoque</p>
      </div>
    </div>
  </div>
  <div class="stat-card card cursor-pointer"
       [ngClass]="{'border-warning': selectedFilter() === 'lowStock', 'shadow': selectedFilter() === 'lowStock'}"
       (click)="filterBy('lowStock')">
    <div style="display:flex;align-items:center;justify-content:flex-start;width:100%;gap:1rem;position:relative;">
      <div class="stat-icon warning" style="position:absolute;left:0;top:50%;transform:translateY(-50%);">‚ö†Ô∏è</div>
      <div style="margin:0 auto;display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <h3 class="stat-value">{{ lowStockCount }}</h3>
        <p class="stat-label">Estoque Baixo</p>
      </div>
    </div>
  </div>
  <div class="stat-card card cursor-pointer"
       [ngClass]="{'border-danger': selectedFilter() === 'outOfStock', 'shadow': selectedFilter() === 'outOfStock'}"
       (click)="filterBy('outOfStock')">
    <div style="display:flex;align-items:center;justify-content:flex-start;width:100%;gap:1rem;position:relative;">
      <div class="stat-icon error" style="position:absolute;left:0;top:50%;transform:translateY(-50%);">‚ùå</div>
      <div style="margin:0 auto;display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <h3 class="stat-value">{{ outOfStockCount }}</h3>
        <p class="stat-label">Sem Estoque</p>
      </div>
    </div>
  </div>
</div>

<!-- Products Table -->
<div class="data-table" *ngIf="filteredProducts().length > 0; else noProducts">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="table-title m-0">Lista de Produtos</h3>
    <div class="d-flex align-items-center gap-2">
      <select class="form-select w-auto" [(ngModel)]="itemsPerPage" (change)="setPage(1)">
          <option [ngValue]="10">10 por p√°gina</option>
          <option [ngValue]="20">20 por p√°gina</option>
          <option [ngValue]="50">50 por p√°gina</option>
          <option [ngValue]="100">100 por p√°gina</option>
        </select>
        <span style="width:1.5rem;display:inline-block;"></span>
        <button class="btn btn-ordenar btn-action d-flex align-items-center" style="gap:0.5rem;" (click)="toggleOrderMenu = !toggleOrderMenu" title="Ordenar">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path d="M3 6h18M7 12h14M10 18h11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
      <div class="position-relative" *ngIf="toggleOrderMenu">
        <div class="card shadow-sm p-2" style="min-width:160px; position:absolute; right:0; z-index:10;">
          <button class="btn btn-outline-primary w-100 mb-1" style="font-weight:400; text-transform:capitalize;" (click)="orderBy.set('name-asc'); applyOrdering(); toggleOrderMenu=false">nome (a-z)</button>
          <button class="btn btn-outline-primary w-100 mb-1" style="font-weight:400; text-transform:capitalize;" (click)="orderBy.set('name-desc'); applyOrdering(); toggleOrderMenu=false">nome (z-a)</button>
          <button class="btn btn-outline-primary w-100 mb-1" style="font-weight:400; text-transform:capitalize;" (click)="orderBy.set('price-asc'); applyOrdering(); toggleOrderMenu=false">menor valor unitario</button>
          <button class="btn btn-outline-primary w-100" style="font-weight:400; text-transform:capitalize;" (click)="orderBy.set('price-desc'); applyOrdering(); toggleOrderMenu=false">maior valor unitario</button>
        </div>
      </div>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Produto</th>
          <th>Marca</th>
          <th>Estoque</th>
          <th>Valor Unit√°rio</th>
          <th>Status</th>
          <th class="text-center">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of paginatedProducts()">
          <td>
            <div class="product-info">
              <h4 class="product-name">{{ product.name }}</h4>
              <p class="product-code" *ngIf="product.manufacturerCode">C√≥d: {{ product.manufacturerCode }}</p>
            </div>
          </td>
          <td>
            <span class="product-brand">{{ product.brand }}</span>
          </td>
          <td>
            <span class="stock-quantity" [class]="getStockClass(product.quantity)">
              {{ product.quantity }} unid.
            </span>
          </td>
          <td>
            <span class="product-price">{{ product.unitPrice | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</span>
          </td>
          <td>
            <span class="badge" [class]="getStockBadgeClass(product.quantity)">
              {{ getStockStatus(product.quantity) }}
            </span>
          </td>
          <td class="text-center">
            <button class="btn btn-sm btn-secondary" (click)="viewDetails(product)" title="Ver detalhes">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <path d="M12 1C12 1 4 9 12 9S20 1 12 1" stroke="currentColor" stroke-width="2"/>
                <path d="M12 23C12 23 20 15 12 15S4 23 12 23" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagina√ß√£o Bootstrap -->
  <nav *ngIf="totalPages > 1" aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="page() === 1">
        <button class="page-link" (click)="setPage(page() - 1)" [disabled]="page() === 1">Anterior</button>
      </li>
      <li class="page-item" *ngFor="let p of [].constructor(totalPages); let i = index" [class.active]="page() === i + 1">
        <button class="page-link" (click)="setPage(i + 1)">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="page() === totalPages">
        <button class="page-link" (click)="setPage(page() + 1)" [disabled]="page() === totalPages">Pr√≥xima</button>
      </li>
    </ul>
  </nav>
</div>

<ng-template #noProducts>
  <div class="card">
    <div class="card-body text-center">
      <div class="table-empty">
        <div class="table-empty-icon">üì¶</div>
        <h3>Nenhum produto encontrado</h3>
        <p>Comece adicionando seu primeiro produto ao cat√°logo</p>
        <button class="btn btn-primary mt-md" (click)="goToRegistration()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 8V16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Adicionar Primeiro Produto
        </button>
      </div>
    </div>
  </div>
</ng-template>
